{"componentChunkName":"component---src-templates-blog-post-js","path":"/week_3/","result":{"data":{"site":{"siteMetadata":{"title":"Antony's Blog"}},"markdownRemark":{"id":"35e7615d-1aca-5541-94e9-e570763c1e26","excerpt":"Deploy Machine Learning Model for simple use. \nHai,Everyone üëã ,\nMachine learning models are no good lying in the Jupyter notebooks or loose python scripts, to‚Ä¶","html":"<h2>Deploy Machine Learning Model for simple use.</h2>\n<p><code class=\"language-text\">3th week of blogging</code><br>\nHai,Everyone üëã ,<br>\nMachine learning models are no good lying in the Jupyter notebooks or loose python scripts, to help other people the model needs to be deployed in a way it‚Äôs usable by the general public and not just by the domain experts. For this, the model needs to embedded in API that other applications can communicate with the model.\n<br>\nSo in this post, I am going to deploy the Emotion analysis model as an WebApp for Simple use.\nif you haven‚Äôt read the post don‚Äôt worry, I am going leave the specifics.<br></p>\n<h4>Things that have to be done are:</h4>\n<blockquote>\n<ol>\n<li>Train the model</li>\n<li>Save the trained model as .h5 file</li>\n<li>Make the design of the Deep learning model and load weights from .h5 file</li>\n<li>Use flask to create Web-App which would encapsulate our trained model and enable it to receive inputs through GET requests and then return the output from the model.</li>\n<li>Upload the flask script along with the trained model on pythonanywhere</li>\n<li>Make requests to the hosted flask script through a website</li>\n</ol>\n</blockquote>\n<p>As we already trained the model we will start with saving the model in .h5 </p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">model_json <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>to_json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/content/drive/My Drive/Emotion-Detection/lstm_model.json'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> json_file<span class=\"token punctuation\">:</span>\n    json_file<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>model_json<span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>save_weights<span class=\"token punctuation\">(</span><span class=\"token string\">'/content/drive/My Drive/Emotion-Detection/lstm_model.h5'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Code for saving the model in JSON format and saving weights in .h5 format.<br>\nWe will be doing this as 2 parts :<br></p>\n<blockquote>\n<ol>\n<li>Flask setup</li>\n<li>Model embedding</li>\n</ol>\n</blockquote>\n<h3>Flask setup</h3>\n<p>Let‚Äôs first set up the flask server on the local host and later deploy it on pythonanywhere for free.\nSetting up flask-app over the localhost:\nMake sure the flask is installed. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pip install flask</code></pre></div>\n<p>File Structre looks like this</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">EmotionAI\n <span class=\"token operator\">|</span>\n +-- flask_app.py\n <span class=\"token operator\">|</span> \n +-- decision.py\n <span class=\"token operator\">|</span> \n +-- static\n <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> \n <span class=\"token operator\">|</span> +-- encoder.pickle\n <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> \n <span class=\"token operator\">|</span> +-- lstm_model.h5\n <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> \n <span class=\"token operator\">|</span> +-- tokenizer.pickle\n +-- templates\n <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> \n <span class=\"token operator\">|</span> +-- index.html</code></pre></div>\n<p> Create a file called flask_app.py in EmotionAI directory and copy the contents to it, and to run the flask server</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">python flask_app.py</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"> \n\n\t<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask<span class=\"token punctuation\">,</span> render_template<span class=\"token punctuation\">,</span> request\n\t<span class=\"token keyword\">from</span> decision <span class=\"token keyword\">import</span> Emotion\n\t \n\tapp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\n\t \n\t<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t emotion<span class=\"token operator\">=</span><span class=\"token string\">\"Enter text to predict\"</span>\n\t confidence<span class=\"token operator\">=</span><span class=\"token string\">\"AI\"</span>\n\t emot <span class=\"token operator\">=</span> Emotion<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>emot<span class=\"token punctuation\">,</span>flush<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\t <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n\t text <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>form<span class=\"token punctuation\">[</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">]</span>\n\t <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span>flush<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\t emotion<span class=\"token punctuation\">,</span>confidence <span class=\"token operator\">=</span> emot<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n\t <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>emotion<span class=\"token punctuation\">,</span>confidence<span class=\"token punctuation\">)</span>\n\t <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> emotion<span class=\"token operator\">=</span>emotion<span class=\"token punctuation\">,</span> confidence<span class=\"token operator\">=</span>confidence<span class=\"token punctuation\">)</span>\n\t <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n\t <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> emotion<span class=\"token operator\">=</span><span class=\"token string\">\"Enter text to predict\"</span> <span class=\"token punctuation\">,</span> confidence<span class=\"token operator\">=</span><span class=\"token string\">\"AI\"</span><span class=\"token punctuation\">)</span>\n\t \n\t \n\t<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n\t app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>debug<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># disable in production</span></code></pre></div>\n<h5>App Route</h5>\n<p>app.route decorator is used for specifying the flask app route over the web.‚Äú/‚Äù simply means the home that is ‚Äú<a href=\"http://127.0.0.1:5000/%E2%80%9D\">http://127.0.0.1:5000/‚Äù</a></p>\n<h5>Request</h5>\n<p>request.form[‚Äòtext‚Äô] gets the text from the HTML form in which the name is text.\nwe give the text to the model ( emot.test(text) )to output emotion, the confidence. Emotion is the emotion of the text and confidence is the confidence with which the model predicts the emotion.</p>\n<h5>Render</h5>\n<p>we use render_template to render the output to the user, so that the user can view the result.<br><br>\nThe following script starts the flask server on localhost and default port (5000) making the URL: <a href=\"http://127.0.0.1:5000/\">http://127.0.0.1:5000/</a>\nJust paste <a href=\"http://127.0.0.1:5000/\">http://127.0.0.1:5000/</a> on browser and press enter to see the server working.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container-fluid home-main<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>col-12<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Emot AI<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blinker<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>(o.o)<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-default<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>View Code<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container-fluid home-content1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>col-md-6 col-sm-12 content1-left<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form_ai<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fieldset</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Text: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Check<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>reset<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-danger<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Clear<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fieldset</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>HTML code for the Form.\n<code class=\"language-text\">&lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;text&quot; placeholder=&quot;text&quot; name=&quot;text&quot; required&gt;</code>\ntake the input and gives it to the model, when submit button is clicked.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>col-md-6 col-sm-12 content1-right<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span>Predicted Emotion <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blinker<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>?<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span><span class=\"token punctuation\">></span></span> {{ emotion }} <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>With a Confidence of {{ confidence }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>The output is shown as above.</p>","frontmatter":{"title":"Deploy Machine Learning Model for simple use.","date":"June 29, 2020","description":"Machine learning models are no good lying in the Jupyter notebooks or loose python scripts. To impact the world, the model needs to be deployed in a way it‚Äôs usable by the general public and not just by the domain experts"}}},"pageContext":{"slug":"/week_3/","previous":{"fields":{"slug":"/week_2/"},"frontmatter":{"title":"Emotion Analysis using Machine Learning Part-2"}},"next":{"fields":{"slug":"/week_4/"},"frontmatter":{"title":"Deploy Machine Learning Model for simple use. Part II"}}}}}